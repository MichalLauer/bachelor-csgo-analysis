\chapter{Praktická část}
{\color{red}
Cílem praktické části je prozkoumat dva typy modelů. První typ modelu bude predikovat výhru zápasu pro jednotlivé hráče přes kategorie map. Hlavním cílem 
modelu bude identifikovat významné charakteristiky hráčů na vybraných mapách a následně rozdíly interpretovat. V druhém modelu bude zkoumaná výhra týmu v zápase.
V tomto typu modelu se jako prediktory použijí agregované charakteristiky hráčů jednotlivých týmu. Pro agregaci bude použit buď aritmetický nebo geometrický průměr. 

V této části se dále nachází popis dat, transformace dat, a tvorba logických regresních modelů. Nejprve jsou představené datové soubory,
se kterými se pracuje. Následně jsou použité grafy, které jsou představené v sekci \ref{sec:vizualizace_dat}. Pomocí vizualizace dat lze představit proměnné, které
do logistického modelu budou vstupovat. Také lze díky grafům získat povědomí, jak datový soubor vypadá a jaké mají proměnné rozdělení.
Poté jsou vytvořené logistické regresní modely, jejich výstup je interpretován a různé modely jsou mezi sebou porovnány.
}

{\color{red}
\section{Cíle analýzy}
Cílem analýzy je vytvořit logistické modely pro předpověď výhry jak pro individuální hráče, tak pro tým. Jelikož se charakteristiky hráčů i zápasů mohou měnit dle mapy,
na které se zápas odehrává, všechny modely budou tříděné přes kategorie map.

Pro hráče budou sestaveny logistické modely z celého datového souboru přes kategorie map. Modely budou následně porovnány pomocí matice záměn
a bude porovnána významnost jejich parametrů. Modely budou porovnané na vybraných dvou mapách, a to Mirage a Vertigo. Mirage je klasický mapa, která je
ve hře od jeho vydání. Vertigo je naopak nejnovější přírůstek do profesionální scény a hráči, v době extrakce datového souboru, mapu ještě plně strategicky 
neznali. Modely budou porovnánu podle přesnosti predikce a podle různé významnosti prediktorů.

Modely pro týmy budou sestavené prve z celého datového souboru a následně pro dva vybrané týmy. První tým, pro který se vytvoří model, bude tým Astralis. Ten je považován
za velmi profesionální a v době extrakce datového souboru patří mezi ty nejlepší týmy na světe. Druhým týmem bude český celek eSuba. eSuba je jeden z nejdéle hrajících celků
v České republice. Modely jsou vytvořené pouze pro dva týmy z toho důvodu, že je celkový počet týmů velmi vysoký a bylo by komplikované 
porovnávat všechny týmy naráz. Z toho důvodu se budou hledat významné rozdíly mezi dvěma referenčními modely a jedním celkovým. Mezi modely bude porovnaná jak přesnost
predikce, tak významnost parametrů. Jelikož je původní spojený datový soubor na úrovni hráčů, charakteristiky hráčů se musí agregovat na úroveň týmů a zápasů. Pro tuto
agregaci bude použit aritmetický nebo geometrický průměr.
}

\section{Datové soubory}
Dataset\footnote{https://www.kaggle.com/datasets/mateusdmachado/csgo-professional-matches} obsahuje čtyři 
{\color{red}
datové soubory
}
, které popisují zápasy ve hře
\ac{CSGO}. K potřebám této bakalářské práce budou použity pouze soubory \textit{players.csv} a \textit{results.csv}. Datové soubory jsou následně spojeny do jedné tabulky,
která obsahuje charakteristiky všech hráčů v právě jednom zápase, potřebné informace o zápase a výsledek (zda hráč zápas vyhrál či nikoliv). Data jsou následně dle potřeby
sjednocena pro týmy v zápase. Charakteristiky se agregují pomocí aritmetického nebo geometrického průměru. Zbylé dva soubory obsahují
informace, které jsou již z probíhajících zápasů a z volby map. Tyto informace pro predikci výhry ještě před začátkem zápasu nelze využít. Žádný z těchto
dvou souborů proto v práci není použit.

\subsection{soubor players.csv}
{\color{red}
Datový soubor
}
\textit{players.csv} obsahuje 
{\color{red}
charakteristiky
}
jednotlivých hráčů v daném zápase. Původní datový soubor obsahuje 101 proměnných a 379 680 pozorování.
V původním datovém souboru se jeden řádek (pozorování) rovná statistikám jednoho hráče za celý zápas
{\color{red}
, který se může odehrávat až na třech mapách.
}
Pro potřeby bakalářské práce je tak nutné získat statistiky hráčů
za jednotlivé mapy. Proto je původní datový soubor transformován do podoby, kde se jedno pozorování rovná statistikám
právě jednoho hráče na právě jedné mapě, a to bez ohledu, kolik map se v daném zápase hrálo. Jinak řečeno, transformovaný datový soubor nebere v potaz, zda
se daná mapa hrála jako první, druhá, či třetí.
Transformovaný dataset má 10 proměnných a 643 620 pozorování. Příklad jednotlivých pozorování v transformovaném
datovém souboru je v přiložené tabulce \ref{tab:players_csv_transformovano}.


\newpage
Transformovaný 
{\color{red}
datový soubor
}
má 10 proměnných. Interpretace je následující:
\begin{itemize}
    \item \textbf{match\_id} --- identifikátor zápasu
    \item \textbf{player\_id} --- identifikátor hráče
    \item \textbf{team} --- jméno týmu
    \item \textbf{map} --- název hrané mapy
    \item \textbf{kills} --- počet zabití hráče v zápase na dané mapě
    \item \textbf{assists} --- počet asistencí hráče v zápase na dané mapě
    \item \textbf{deaths} --- počet smrtí hráče v zápase na dané mapě
    \item \textbf{hs} --- procento zabití, které lze označit jako headshot\footnote{hráč zabil nepřítele střelou do hlavy}
    \item \textbf{fkdiff} --- rozdíl, kolikrát hráč zabil jako první nepřítele versus kolikrát byl zabit jako první
    \item \textbf{rating} --- shrnutí více statistik za jeden zápas do jednoho ukazatele výkonu\footnote{\url{https://www.hltv.org/news/20695/introducing-rating-20}}
\end{itemize}

\subsection{soubor results.csv}
Druhý datový soubor, který je pro analýzu použit, obsahuje výsledky daných zápasů. Soubor se původně skládá z 45 773 záznamů a 19 proměnných. Dataset obsahuje na rozdíl
od datového souboru \textit{players.csv} jedno chybné pozorování. Dle něho hrál tým sám proti sobě, což nedává smysl. Jelikož je zápas na webovém portálu zadán
správně, nejspíše se jedná o neznámou chybu, která nastala při exportu dat z webového portálu.

Po transformacích vznikne tabulka o 8 proměnných a 91 436 záznamech. Každé pozorování identifikuje výsledek jednoho týmu v jednom zápase
na jedné mapě. Příklad je zobrazen v přiložené tabulce \ref{tab:results_csv_transformovano}. Jednotlivé proměnné lze interpretovat následovně:
\begin{itemize}
    \item \textbf{date} --- datum, kdy se hrál zápas
    \item \textbf{match\_id} --- identifikátor zápasu
    \item \textbf{team} --- jméno týmu
    \item \textbf{map} --- název hrané mapy
    \item \textbf{map\_winner} --- binární značení, zda tým vyhrál (1) či prohrál (0)
    \item \textbf{starting\_ct} --- binární značení, zda tým začal zápas na straně Counter-Teroristů (1) či Teroristů (0)
    \item \textbf{team\_rank} --- rank týmu v okamžik, kdy se zápas hrál\footnote{\url{https://www.hltv.org/news/16061/introducing-csgo-team-ranking}}
    \item \textbf{run\_mean\_3\_months} --- klouzavý průměr týmu za poslední tři měsíce
\end{itemize}

\subsection{Omezení datového souboru}
{\color{red}
Všechny datové soubory obsahují pozorování o zápasech a charakteristikách hráčů od konce roku 2015 do začátku roku 2020. Jelikož pro finální modely je nutné datové soubory
\textit{players.csv} a \textit{results.csv} sjednotit, může se stát, že se vytvoří zápas bez hráčů. Může také nastat situace, kdy zápas nebude mít přiřazených právě 
deset různých hráčů. To může nastat když tým nemá v zápasu právě 5 hráčů. Tým může mít méně než 5 hráčů z toho důvodu, že je např.
amatérsky\footnote{neprofesionální, tím pádem nemusí mít všichni hráči na webovém portálu založená profil}. Více hráčů může hrát za tým v případě, že tým použil náhradníka.
Zároveň je možné, že kvůli historickým změnám ve hře a na webovém portálu nebude možné získat všechny potřebné charakteristiky hráčů. Také je nutné kontrolovat,
zda tým nehrál sám proti sobě. V případě všech zmíněných chyb jsou chybné záznamy odstraněny.
}

\section{Průzkumová analýza dat}
Průzkumová analýza vizualizuje prediktory, hledá různé vztahy a rozdělení proměnných. Díky průzkumu lze určit, které proměnné není vhodné použít pro tvorbu
logistického regresního modelu, např. kvůli problému multikolinearity.

\newpage
\subsection{Korelační matice}
Pro logistickou regresi je důležité, aby prediktory nebyly lineárně závislé. Přehled korelací mezi kvantitativními prediktory lze zjistit z korelační matice.

\begin{figure}[H]
    \centering
    \includegraphics{../obrazky/prediktory_corr_matice.png}
    \caption{Korelační matice} 
    \label{fig:korelacni_matice}
\end{figure}

Z korelační matice \ref{fig:korelacni_matice} lze vyčíst, 
{\color{red}
že korelace mezi průměrem týmu za poslední tři měsíce a statistikami hráčů se blíží nule. Z toho plyne, že neexistuje lineární závislost mezi výkonem hráčů a 
průměrným rankem týmu za poslední tři měsíce.
}
Zároveň je vidět silná korelace mezi prediktorem \textit{rating} a prediktory \textit{fkdiff}, \textit{deaths} a \textit{kills}.
{\color{red}
Jelikož by díky vysoké korelaci prediktorů vznikl problém multikolinearity, prediktor \textit{rating} ve finálních modelech není použit.
}

\newpage
\subsection{Histogramy kvantitativních prediktorů}
Histogramy kvantitativních prediktorů umožní zobrazit jejich rozdělení.

\begin{figure}[H]
    \centering
    \includegraphics{../obrazky/histogram_prediktoru.png}
    \caption{Histogram prediktorů} 
    \label{fig:histogram_prediktoru}
\end{figure}

Histogram prediktorů \textit{rating}, \textit{hs}, \textit{kills} a \textit{deaths} má normální rozdělení a v proměnné se nenachází mnoho extrémních hodnot.
Prediktor \textit{fkdiff} má bimodální rozdělení. Prediktor \textit{assists} je 
{\color{red}
zešikmení
}
doprava, což značí velké množství odlehlých či extrémních hodnot. 
{\color{red}
Pro logistickou regresy není předpoklad normálního rozdělení prediktorů. Proto analýza slouží hlavně k získání povědomí o tom, 
jakých hodnot každý prediktor nabývá a jaké je jejich rozdělení.
}

\newpage
{\color{red}
\subsection{Sloupcový graf výher přes počáteční stranu}
Každá mapa funguje a vypadá jinak, což ovlivňuje mimo jiné i možné strategie. Proto jiné mapy mohou více vyhovovat jiným týmům. Toto způsobuje, že
tým může mít vyšší procento výhry na mapě, pokud začíná na straně Counter-Terroristů.

\begin{figure}[H]
    \centering
    \includegraphics{../obrazky/sloupce_podle_strany.png}
    \caption{Procento vyhraných zápasů na dané mapě za stranu Counter-Terroristů} 
    \label{fig:sloupcovy_graf_strany}
\end{figure}

Z obrázku \ref{fig:sloupcovy_graf_strany} je patrné, že týmu Astralis nevyhovuje začínat mapu Cobblestone na straně Counter-Terroristů. Tým eSuba nemá žádný vyhraný zápas
při začínající straně Counter-Terroristů na mapě Train. Díky obrázku je vidět, že šanci na výhru ovlivňuje interakce mezi mapou a začínající stranou. Logistický model
by měl tento vztah reflektovat. 
}

\section{Modely pro výkon hráče}
{\color{red}
Cílem modelu je predikovat výhru zápasu pro jednotlivé hráče a identifikovat významné prediktory na odlišných mapách.
}
Prediktory se týkají pouze výkonu jednotlivých hráčů, model tedy pro předpověď výhry hráče nepoužívá statistiky spoluhráčů. Pro porovnání jsou vybrané mapy Mirage a Vertigo.
Mapa Mirage je jednou z nejvíce tradičních map a mapa Vertigo je naopak nejnovější přídavek do hry. Díky rozdílným modelům bude možné zkoumat, na čem pravděpodobnost výhry na 
mapách záleží. Pro vytvoření logistického modelu je použito 80\% náhodně vybraných pozorování. Zbylých 20\% je použito pro
{\color{red}
ověření kvality modelu.
}

\subsection{Model pro mapu Mirage}

\input{kod/mirage_pro_hrace.tex}

Pro model jsou významné všechny prediktory. S rostoucím počtem zabití, asistencí a statistikou fkdiff má hráč větší šanci mapu vyhrát. Naopak s rostoucím počtem smrtí a 
statistikou hs, šance na výhru klesá. Mapa je pro stranu Counter-Terroristů nevýhodná, a pokud hráč začne mapu na této straně, jeho šance na výhru klesá. Největší vliv
má na pravděpodobnost výhry počet úmrtí hráče. Přepis funkce pak vypadá následovně

\begin{align}
    \begin{split}
        &P(1 | X_{kills}, X_{assists}, X_{deaths}, X_{hs}, X_{fkdiff}, X_{starting_ct}) = \frac{1}{1 + e^{-z}} \\
        &z = 2,446 + 0,181*X_{kills} + 0,302*X_{assists} - 0,369*X_{deaths} + \\
        &- 0,134*X_{hs} + 0,015*X_{fkdiff} - 0,227*X_{starting_ct}
    \end{split}
\end{align}

\subsection{Matice záměn pro mapu Mirage}
Predikce jsou provedené na validačním podmnožině z datového souboru.

\input{kod/mirage_pro_hrace_matice.tex}

Model predikoval správně 7 022 výher a 6 709 proher. Z matice záměn lze dále vypočítat následující statistiky:

\input{kod/mirage_pro_hrace_matice_stats.tex}

Model určuje zhruba 79,5 \% objektů správně. Specificita je o zhruba 4 \% body vyšší než senzitivita, což značí, že je model úspěšnější při predikci proher
než výher.

\subsection{Model pro mapu Vertigo}

\input{kod/vertigo_pro_hrace.tex}

Pro hráče jsou na mapě Vertigo významné pouze prediktory \textit{kills}, \textit{assists} a \textit{deaths}. Ostatní prediktory \textit{hs}, \textit{fkdiff} a \textit{starting\_ct}
jsou pro model nevýznamné. Nevýznamnost lze interpretovat tak, že pro hráče není důležité, na jaké straně mapu začnou hrát (prediktor  \textit{starting\_ct}), ani jak přesně
střílí (prediktor \textit{HS}). Zde má na výhru hráče největší negativní vliv počet úmrtí. Po vyřazení nevýznamných prediktorů má model následující významné parametry

\input{kod/vertigo_pro_hrace_opt.tex}

Přepis funkce je pak následující

\begin{align}
    \begin{split}
        &P(1 | X_{kills}, X_{assists}, X_{deaths}) = \frac{1}{1 + e^{-z}} \\
        &z = 1,893 + 0,184*X_{kills} + 0,301*X_{assists} - 0,352*X_{deaths}
    \end{split}
\end{align}

Každé zabití zvyšuje šanci na výhru o zhruba $6.63$. Naopak každá smrt hráče šanci na výhru snižuje zhruba $0.70$.

\newpage
\subsection{Matice záměn pro mapu Vertigo}
Matice záměn pro logistický model sestavený pro mapu Vertigo je následující

\input{kod/vertigo_pro_hrace_matice.tex}

Model úspěšné predikoval 415 výher a 441 proher. Z matice záměn pak lze získat výkonnostní statistiky.

\input{kod/vertigo_pro_hrace_matice_stats.tex}

Na nových datech model určil správně zhruba 77,7\% pozorování. Model má 80\% senzitivitu, což je více než jeho specificita o zhruba 5 \%. Model je tedy spolehlivější
pro předpověď výhry hráče.

\subsection{Interpretace výsledků}
Model pro mapu Mirage je přesnější a je spolehlivější pro předpověď prohry hráče. Model pro mapu Vertigo má menší přesnost o zhruba 
2 procentní body a je vhodnější pro predikování výhry se 80 \% senzitivitou.

Pro logistický model mapy Mirage jsou významné všechny zvolené prediktory. Největší vliv na výhru hráče na mapě Mirage má počet jeho smrtí, kdy s každou další smrtí se šance
na výhru zmenšuje o zhruba 0,69. Pro mapu Vertigo jsou významné pouze prediktory \textit{kills}, \textit{assists} a \textit{deaths} a největší vliv na výhru hráče
má zde také počet smrtí.

Rozdíl by mohl být vysvětlen právě stářím jednotlivých map. Jelikož je mapa Mirage už tradiční mapou, mnoho hráčů na ní zná různé triky a strategie. To vede k tomu, že
každý malý detail hraje velikou roli a všechny vybrané prediktory jsou pro model významné. Naopak mapa Vertigo je relativně nová a pro hráče je nejdůležitější individuální
výkon. Jelikož hráči mapu tak dobře strategicky neznají, jsou významné pouze statistiky jejich hráčů.